<html doctype=html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Client rpiWater</title>
  </head>
  <body>
    <div>
      <label>
        <span>ip</span>
        <input id="ip_inputter"/>
      </label>
      <label>
        <span>port</span>
        <input id="port_inputter"/>
      </label>
    </div>
    <div id="msg_content" style="width:90%;min-height: 200px;border: 1px solid #eee; overflow:auto">
    
    </div>
    <button onclick="do_connect_server()">connect</button>
    <button onclick="do_start()">start</button>
    <button onclick="do_stop()">stop</button>
    <script>
      window.ws = null
      function init () {
        if (window.ws) {
           document.getElementById("msg_content").innerHTML +=  "already connect" + "<br/>"
          return false
        }
        let ip = document.getElementById("ip_inputter").value
        let port = document.getElementById("port_inputter").value
        window.ws = new WebSocket("ws://" + ip + ":" + port)
        window.ws.onopen = function () {
           document.getElementById("msg_content").innerHTML +=  "connect open" + "<br/>"
        }
        window.ws.onmessage = function (e) {
          document.getElementById("msg_content").innerHTML +=  e + "<br/>"
        }
        window.ws.onclose = function (e) {
           document.getElementById("msg_content").innerHTML +=  e + "<br/>"
        }
        window.ws.onerror = function (e) {
           document.getElementById("msg_content").innerHTML +=  e + "<br/>"
        }
      }
      
      // connect to server
      function do_connect_server () {
        document.getElementById("msg_content").innerHTML += "do init" + "<br/>"
        init()
      }
      // start test
      function do_start () {
        document.getElementById("msg_content").innerHTML += "do send start" + "<br/>"
        window.ws.send(JSON.stringify({"opa" :"start"}))
      }
      // stop test
      function do_stop () {
        document.getElementById("msg_content").innerHTML += "do send stop" + "<br/>"
        window.ws.send(JSON.stringify({"opa" :"stop"}))
      }
    </script>
  </body>
</html>